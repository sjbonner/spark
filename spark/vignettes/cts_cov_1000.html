<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Simon Bonner" />

<meta name="date" content="2023-05-16" />

<title>Continuous Covariate Model</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Continuous Covariate Model</h1>
<h4 class="author">Simon Bonner</h4>
<h4 class="date">2023-05-16</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Here we illustrate how spark may be applied speed fitting CJS-based
models incorporating continuous, time-varying, individual covariates.
Data considered was simulated for a total of <span class="math inline">\(N=1000\)</span> marked individuals over <span class="math inline">\(T=10\)</span> capture occasions. The initial time
of capture and marking for each individual, denoted by <span class="math inline">\(a_i\)</span> for the <span class="math inline">\(i^{th}\)</span> individual, was sampled at random
from <span class="math inline">\(1,\ldots,9\)</span>. Covariate values,
denoted by <span class="math inline">\(z_{it}\)</span> for indivdiual
<span class="math inline">\(i\)</span> on occasion <span class="math inline">\(t\)</span>, for each were generated according to a
normal random walk: <span class="math display">\[z_{ia_i} \sim
N(\mu_0,\sigma^2))\]</span> <span class="math display">\[z_{it} \sim
N(z_{i,t-1}+\mu_{t-1},\sigma_1^2), \quad t=a_i+1,\ldots,T.\]</span>
Captures histories were the generated with capture and survival
probabilities: <span class="math display">\[\mathrm{logit}(p_{it})=\beta_0 + \beta_1
z_{it}\]</span> <span class="math display">\[\mathrm{logit}(\phi_{it})=\gamma_0 + \gamma_1
z_{it}.\]</span> For this simulation we have set: <span class="math inline">\(\mu_0=0\)</span>, <span class="math inline">\(\mu_t=1/9\)</span> for all <span class="math inline">\(t\)</span>, <span class="math inline">\(\sigma_0=.1\)</span>, <span class="math inline">\(\sigma_1=.2\)</span> <span class="math inline">\(\beta_0=0\)</span>, <span class="math inline">\(\beta_1=0\)</span>, <span class="math inline">\(\gamma_0=0\)</span>, and <span class="math inline">\(\gamma_1=1\)</span>.</p>
</div>
<div id="jags-code" class="section level2">
<h2>JAGS code</h2>
<p>The JAGS source code is installed on your machine at
C:/Users/Simon/OneDrive - The University of Western
Ontario/R_Packages/spark/spark/inst/JAGS/cts_cov_jags.R. The likelihood
for this model is difficult to encode with the built in distribution
functions and instead is implemented with the ones trick. As with the
other models fit with truncation, the data is modeled on a
release-by-release basis. The probability associated with the recapture
event is computed for each release and then implicity multiplied via a
vector of dummy Bernoulli variables all equal to 1. The main data
structures in this model are <em>Z</em>, the matrix of covariate values,
and <em>drecap</em>, a vector recording the number of occasions between
release and recaptured for each release. If an individual is not
recaptured then <em>drecap</em> is set equal to the minimum of the
truncation factor , <span class="math inline">\(k\)</span> (equal to 5
here), and the number of capture occasions remaining in the study after
the release time. The remaining data values are: * nocc – the number of
capture occasions, * nrelease – the total number of releases over all
indivdiuals, * nrecapture – the total number of releases after which an
individual was recaptured, and * release – the vector release times
(length nrelease).</p>
</div>
<div id="analysis" class="section level2">
<h2>Analysis</h2>
<div id="preliminaries" class="section level3">
<h3>Preliminaries</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spark)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RMark)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rjags)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Load data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cts_cov_data&quot;</span>)</span></code></pre></div>
</div>
<div id="data-formatting" class="section level3">
<h3>Data Formatting</h3>
<p>Data formatting for this model is somewhat more complicated because
of the use of the ones trick. The likelihood contribution must be
computed differently for individuals that were recaptured within <span class="math inline">\(k\)</span> occasions after release and those that
weren’t. The simplest way to do this is to order the individuals so that
the data for the <em>nrecapture</em> events on which individuals were
recaptured come first. The likelihood can then be computed with two
separate for loops that loop first over the events on which individuals
were recaptured and then over the events on which individuals were not
recaptured. The data is formatted as follows:</p>
<p>First, we truncate the data and compute <em>drecap</em>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Truncate data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>truncdata <span class="ot">&lt;-</span> <span class="fu">spark</span>(cts_cov_data,<span class="at">informat=</span><span class="st">&quot;spark&quot;</span>,<span class="at">outformat=</span><span class="st">&quot;spark&quot;</span>,<span class="at">k=</span>k)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Construct drecap</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>drecap <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(truncdata<span class="sc">$</span>recapture <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                 truncdata<span class="sc">$</span>recapture<span class="sc">-</span>truncdata<span class="sc">$</span>release,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">pmin</span>(k,T<span class="sc">-</span>truncdata<span class="sc">$</span>release))</span></code></pre></div>
<p>Next we construct the matrix of observed covariate values:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Format covariate matrix</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span>truncdata<span class="sc">$</span>nrelease,<span class="at">ncol=</span>k<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>truncdata<span class="sc">$</span>nrelease){</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    Z[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> truncdata<span class="sc">$</span>other[truncdata<span class="sc">$</span>ind[i],truncdata<span class="sc">$</span>release[i]]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(truncdata<span class="sc">$</span>recapture[i] <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        Z[i,drecap[i]<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> truncdata<span class="sc">$</span>other[truncdata<span class="sc">$</span>ind[i],truncdata<span class="sc">$</span>recapture[i]]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally we reorder the data so that the indivdiuals which were
recaptured come first in the data structures:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Order data so that recaptures come first</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">which</span>(truncdata<span class="sc">$</span>recapture <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp,(<span class="dv">1</span><span class="sc">:</span>truncdata<span class="sc">$</span>nrelease)[<span class="sc">-</span>tmp])</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>nrecapture <span class="ot">&lt;-</span> <span class="fu">length</span>(tmp)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Construct data list</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">nocc=</span>T,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nrecapture=</span>nrecapture,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">release=</span>truncdata<span class="sc">$</span>release[index],</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nrelease=</span>truncdata<span class="sc">$</span>nrelease,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">drecap=</span>drecap[index],</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z=</span>Z[index,],</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dummy=</span><span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(truncdata<span class="sc">$</span>chmat)))</span></code></pre></div>
</div>
<div id="initial-values" class="section level3">
<h3>Initial Values</h3>
<p>For simplicity, I have run a single chain with static initial values.
Actual analyses should rely on multiple chains with diffuse initial
values to assess convergence of the algorithms.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Set intial values</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">beta.phi=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">beta.p=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mu.z=</span><span class="fu">rep</span>(<span class="dv">0</span>,T<span class="dv">-1</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tau.z=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="mcmc-sampling" class="section level3">
<h3>MCMC Sampling</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Run model in JAGS</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">## This is how the model is run via rjags. However, this can take some time and requires JAGS to be installed, so that the vignette will not pass the CRAN check.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># modelFile &lt;- system.file(&quot;JAGS/cts_cov_jags.R&quot;,package=&quot;spark&quot;)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># system.time(jagsModel &lt;- jags.model(modelFile,data=jags.data,inits=jags.inits,n.adapt=1000))</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pars &lt;- c(&quot;beta.phi&quot;,&quot;beta.p&quot;,&quot;mu.z&quot;,&quot;sigma.z&quot;)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># time.trunc &lt;- system.time(coda.trunc &lt;- coda.samples(jagsModel,pars,n.iter=10000))</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Instead, we can load stored output from a previous run.</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;cts_cov_1000_output_trunc.RData&quot;</span>,<span class="at">package=</span><span class="st">&quot;spark&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="summarize-output" class="section level2">
<h2>Summarize output</h2>
<p>The following table compares the true parameter values with the
posterior means, standard deviations, and upper and lower 2.5%-iles
estimated from the MCMC chain. Posterior means for all parameters are
close to the truth and the central 95% credible intervals all cover the
true values. Effective samples sizes (ESS) are also included.</p>
<pre><code>##             Truth     ESS  Mean   SD  2.5%   50% 97.5%
## beta.p[1]     0.0 1567.62  0.10 0.12 -0.14  0.10  0.35
## beta.p[2]     0.0 1460.23 -0.45 0.23 -0.91 -0.45 -0.01
## beta.phi[1]   0.0 2354.54 -0.10 0.07 -0.23 -0.10  0.03
## beta.phi[2]   1.0 2146.98  1.22 0.14  0.95  1.21  1.51
## mu.z[1]       0.0   88.54  0.00 0.08 -0.15  0.00  0.16
## mu.z[2]       0.0  231.45 -0.02 0.04 -0.10 -0.02  0.05
## mu.z[3]       0.0  217.33  0.01 0.03 -0.06  0.01  0.07
## mu.z[4]       0.0  374.82 -0.02 0.03 -0.08 -0.02  0.03
## mu.z[5]       0.0  321.10 -0.07 0.03 -0.13 -0.07 -0.02
## mu.z[6]       0.0  261.68  0.02 0.03 -0.04  0.02  0.08
## mu.z[7]       0.0  285.95 -0.03 0.03 -0.09 -0.03  0.02
## mu.z[8]       0.0  217.29  0.12 0.03  0.05  0.12  0.18
## mu.z[9]       0.0  116.85 -0.06 0.04 -0.14 -0.06  0.02
## mu.z[10]      0.0  260.30  0.02 0.03 -0.05  0.02  0.07
## mu.z[11]      0.0  295.97 -0.02 0.03 -0.08 -0.02  0.03
## mu.z[12]      0.0  155.01  0.02 0.04 -0.06  0.02  0.10
## mu.z[13]      0.0  247.10 -0.01 0.03 -0.07 -0.01  0.05
## mu.z[14]      0.0  208.25  0.01 0.03 -0.05  0.01  0.08
## mu.z[15]      0.0  328.02  0.08 0.03  0.02  0.08  0.13
## mu.z[16]      0.0  270.95 -0.01 0.03 -0.06 -0.01  0.04
## mu.z[17]      0.0  276.23  0.00 0.03 -0.05  0.00  0.05
## mu.z[18]      0.0  308.24  0.03 0.03 -0.03  0.03  0.09
## mu.z[19]      0.0  191.09  0.06 0.04 -0.01  0.06  0.13
## mu.z[20]      0.0  196.12 -0.03 0.03 -0.09 -0.03  0.04
## mu.z[21]      0.0  115.75 -0.04 0.04 -0.12 -0.04  0.04
## mu.z[22]      0.0  127.22  0.05 0.04 -0.03  0.05  0.13
## mu.z[23]      0.0  153.68 -0.07 0.04 -0.15 -0.07  0.01
## mu.z[24]      0.0  445.25  0.03 0.03 -0.02  0.03  0.09
## mu.z[25]      0.0  356.11 -0.04 0.03 -0.09 -0.04  0.01
## mu.z[26]      0.0  186.02  0.01 0.04 -0.06  0.01  0.08
## mu.z[27]      0.0  170.69  0.01 0.03 -0.05  0.01  0.08
## mu.z[28]      0.0  246.38  0.03 0.03 -0.02  0.03  0.09
## mu.z[29]      0.0  103.96  0.03 0.04 -0.04  0.03  0.10
## mu.z[30]      0.0  208.42  0.08 0.03  0.02  0.08  0.14
## mu.z[31]      0.0  204.89 -0.01 0.03 -0.07 -0.01  0.05
## mu.z[32]      0.0  183.96 -0.02 0.03 -0.08 -0.02  0.05
## mu.z[33]      0.0  164.40  0.03 0.03 -0.04  0.03  0.09
## mu.z[34]      0.0  266.29  0.06 0.03  0.01  0.06  0.11
## mu.z[35]      0.0  266.11  0.00 0.03 -0.05  0.00  0.06
## mu.z[36]      0.0  203.36  0.04 0.03 -0.02  0.04  0.10
## mu.z[37]      0.0  170.73  0.04 0.03 -0.02  0.04  0.10
## mu.z[38]      0.0  139.12 -0.01 0.03 -0.07 -0.02  0.05
## mu.z[39]      0.0  128.49  0.00 0.03 -0.07  0.00  0.07
## mu.z[40]      0.0  125.36 -0.02 0.04 -0.11 -0.02  0.06
## mu.z[41]      0.0  234.34  0.02 0.03 -0.04  0.02  0.08
## mu.z[42]      0.0  152.92  0.04 0.03 -0.03  0.04  0.11
## mu.z[43]      0.0  343.97 -0.03 0.03 -0.07 -0.03  0.03
## mu.z[44]      0.0  249.82  0.05 0.03 -0.01  0.04  0.10
## mu.z[45]      0.0  194.94  0.06 0.03 -0.01  0.06  0.12
## mu.z[46]      0.0  296.60 -0.02 0.03 -0.08 -0.02  0.04
## mu.z[47]      0.0  148.87  0.03 0.04 -0.06  0.03  0.11
## mu.z[48]      0.0  267.98  0.01 0.03 -0.06  0.01  0.07
## mu.z[49]      0.0  501.58 -0.01 0.03 -0.07 -0.01  0.05
## sigma.z       0.2  159.21  0.10 0.00  0.09  0.10  0.11</code></pre>
<p>Traceplots for the key parameters, below, show that the chains have
converged well and the ESS are sufficient for most parameters, though
larger samples from multiple chains would be required in real
applications. <img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="full-data" class="section level2">
<h2>Full Data</h2>
<p>For comparison we again run the analysis on the full data set by
setting <span class="math inline">\(k=T-1\)</span>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Format data to use the same code</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> T<span class="dv">-1</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>fulldata <span class="ot">&lt;-</span> <span class="fu">spark</span>(cts_cov_data,<span class="at">informat=</span><span class="st">&quot;spark&quot;</span>,<span class="at">outformat=</span><span class="st">&quot;spark&quot;</span>,<span class="at">k=</span>k)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Construct drecap</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>drecap <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(truncdata<span class="sc">$</span>recapture <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                 truncdata<span class="sc">$</span>recapture<span class="sc">-</span>truncdata<span class="sc">$</span>release,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">pmin</span>(k,T<span class="sc">-</span>truncdata<span class="sc">$</span>release))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Format covariate matrix</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span>truncdata<span class="sc">$</span>nrelease,<span class="at">ncol=</span>k<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>truncdata<span class="sc">$</span>nrelease){</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    Z[i,<span class="dv">1</span>] <span class="ot">&lt;-</span> truncdata<span class="sc">$</span>other[truncdata<span class="sc">$</span>ind[i],truncdata<span class="sc">$</span>release[i]]</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(truncdata<span class="sc">$</span>recapture[i] <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        Z[i,drecap[i]<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> truncdata<span class="sc">$</span>other[truncdata<span class="sc">$</span>ind[i],truncdata<span class="sc">$</span>recapture[i]]</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Order data so that recaptures come first</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">which</span>(truncdata<span class="sc">$</span>recapture <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">c</span>(tmp,(<span class="dv">1</span><span class="sc">:</span>truncdata<span class="sc">$</span>nrelease)[<span class="sc">-</span>tmp])</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>nrecapture <span class="ot">&lt;-</span> <span class="fu">length</span>(tmp)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Construct data list</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>jags.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">nocc=</span>T,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nrecapture=</span>nrecapture,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">release=</span>truncdata<span class="sc">$</span>release[index],</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nrelease=</span>truncdata<span class="sc">$</span>nrelease,</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">drecap=</span>drecap[index],</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">Z=</span>Z[index,],</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dummy=</span><span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(truncdata<span class="sc">$</span>chmat)))</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Set intial values</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>jags.inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">beta.phi=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">beta.p=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mu.z=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">9</span>),</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                   <span class="at">tau.z=</span><span class="dv">1</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Run model in JAGS</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="do">## This is how the model is run via rjags. However, this can take some time and requires JAGS to be installed, so that the vignette will not pass the CRAN check.</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co"># modelFile &lt;- system.file(&quot;JAGS/cts_cov_jags.R&quot;,package=&quot;spark&quot;)</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co"># system.time(jagsModel &lt;- jags.model(modelFile,data=jags.data,inits=jags.inits,n.adapt=1000))</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># pars &lt;- c(&quot;beta.phi&quot;,&quot;beta.p&quot;,&quot;mu.z&quot;,&quot;sigma.z&quot;)</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="co"># time.full &lt;- system.time(coda.full &lt;- coda.samples(jagsModel,pars,n.iter=10000))</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Instead, we can load stored output from a previous run.</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;cts_cov_1000_output_full.RData&quot;</span>,<span class="at">package=</span><span class="st">&quot;spark&quot;</span>))</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Numerical summaries</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>summ.full <span class="ot">&lt;-</span> <span class="fu">summary</span>(coda.full)</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(<span class="fu">data.frame</span>(<span class="at">Truth=</span><span class="fu">c</span>(beta.p,beta.phi,mu.z[<span class="sc">-</span><span class="dv">1</span>],sigma[<span class="sc">-</span><span class="dv">1</span>]),</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ESS=</span><span class="fu">effectiveSize</span>(coda.full)),</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>                 summ.full[[<span class="dv">1</span>]][,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                 summ.full[[<span class="dv">2</span>]][,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)]),<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##             Truth     ESS  Mean   SD  2.5%   50% 97.5%
## beta.p[1]     0.0 1683.16  0.05 0.12 -0.19  0.05  0.28
## beta.p[2]     0.0 1575.00 -0.21 0.21 -0.64 -0.21  0.19
## beta.phi[1]   0.0 2457.82 -0.09 0.07 -0.22 -0.09  0.04
## beta.phi[2]   1.0 2619.32  1.11 0.13  0.86  1.11  1.36
## mu.z[1]       0.0  195.09  0.01 0.07 -0.13  0.01  0.15
## mu.z[2]       0.0  354.54 -0.02 0.04 -0.09 -0.02  0.07
## mu.z[3]       0.0  227.10  0.00 0.04 -0.07  0.00  0.07
## mu.z[4]       0.0  392.17 -0.03 0.03 -0.09 -0.03  0.04
## mu.z[5]       0.0  289.70 -0.08 0.03 -0.14 -0.08 -0.02
## mu.z[6]       0.0  292.25  0.00 0.03 -0.06  0.00  0.06
## mu.z[7]       0.0  277.88 -0.04 0.03 -0.10 -0.04  0.02
## mu.z[8]       0.0  169.50  0.09 0.04  0.02  0.09  0.16
## mu.z[9]       0.0   88.10 -0.08 0.04 -0.16 -0.07  0.00
## mu.z[10]      0.0  176.54  0.01 0.03 -0.06  0.01  0.06
## mu.z[11]      0.0  187.62 -0.04 0.03 -0.10 -0.04  0.02
## mu.z[12]      0.0   95.89  0.00 0.04 -0.08  0.00  0.08
## mu.z[13]      0.0  154.78 -0.03 0.03 -0.09 -0.03  0.03
## mu.z[14]      0.0  107.62  0.00 0.03 -0.06  0.00  0.06
## mu.z[15]      0.0  112.12  0.06 0.03  0.00  0.06  0.13
## mu.z[16]      0.0  133.25 -0.02 0.03 -0.08 -0.02  0.04
## mu.z[17]      0.0  168.05 -0.01 0.03 -0.06 -0.01  0.04
## mu.z[18]      0.0  122.08  0.01 0.03 -0.05  0.01  0.07
## mu.z[19]      0.0   87.46  0.05 0.03 -0.01  0.05  0.12
## mu.z[20]      0.0   77.11 -0.03 0.04 -0.10 -0.03  0.04
## mu.z[21]      0.0   59.12 -0.04 0.04 -0.12 -0.04  0.04
## mu.z[22]      0.0   55.33  0.05 0.04 -0.03  0.05  0.13
## mu.z[23]      0.0   67.40 -0.08 0.03 -0.14 -0.08 -0.01
## mu.z[24]      0.0   86.53  0.03 0.03 -0.03  0.02  0.08
## mu.z[25]      0.0  107.21 -0.04 0.03 -0.09 -0.04  0.01
## mu.z[26]      0.0   56.37  0.00 0.03 -0.06  0.00  0.07
## mu.z[27]      0.0   64.72  0.01 0.03 -0.05  0.01  0.08
## mu.z[28]      0.0   68.50  0.02 0.03 -0.04  0.02  0.08
## mu.z[29]      0.0   58.71  0.01 0.04 -0.05  0.01  0.09
## mu.z[30]      0.0   60.70  0.07 0.03  0.02  0.07  0.14
## mu.z[31]      0.0   54.18 -0.02 0.03 -0.08 -0.02  0.05
## mu.z[32]      0.0   55.34 -0.04 0.03 -0.11 -0.04  0.02
## mu.z[33]      0.0   45.36  0.01 0.04 -0.06  0.01  0.08
## mu.z[34]      0.0   82.70  0.05 0.02  0.00  0.05  0.10
## mu.z[35]      0.0   51.07 -0.01 0.03 -0.08 -0.01  0.05
## mu.z[36]      0.0   42.97  0.02 0.03 -0.04  0.02  0.09
## mu.z[37]      0.0   66.01  0.02 0.03 -0.03  0.02  0.07
## mu.z[38]      0.0   37.66 -0.04 0.03 -0.11 -0.04  0.02
## mu.z[39]      0.0   38.95 -0.03 0.03 -0.10 -0.03  0.04
## mu.z[40]      0.0   19.39 -0.05 0.05 -0.15 -0.05  0.03
## mu.z[41]      0.0   34.93  0.02 0.04 -0.06  0.02  0.09
## mu.z[42]      0.0   30.56  0.02 0.04 -0.07  0.02  0.09
## mu.z[43]      0.0   56.71 -0.02 0.03 -0.08 -0.02  0.03
## mu.z[44]      0.0   49.55  0.03 0.03 -0.02  0.04  0.09
## mu.z[45]      0.0   51.50  0.05 0.03 -0.01  0.05  0.10
## mu.z[46]      0.0   33.47 -0.03 0.03 -0.10 -0.03  0.04
## mu.z[47]      0.0   27.23  0.00 0.04 -0.08  0.00  0.08
## mu.z[48]      0.0   50.39  0.00 0.03 -0.05  0.00  0.07
## mu.z[49]      0.0   51.12 -0.02 0.03 -0.09 -0.02  0.04
## sigma.z       0.2    6.47  0.11 0.01  0.09  0.10  0.13</code></pre>
<p>Comparing results, the estimated posterior standard deviations
computed from the truncated data were, on average, 0.98 times as large
as those computed from the full data set. The runtime for the truncated
data was 735 seconds in comparison to 6369 seconds for the full data
set, a speed up of 8.66 times.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
